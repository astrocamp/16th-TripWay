{% extends "layouts/base.html" %}
{% load static %}
{% block content %}

<div class="flex flex-col items-center justify-center py-12">
    <div class="w-full max-w-md">
        <h1 class="mb-8 text-2xl font-bold text-center">評論景點</h1>

        <!-- 評分和評論系統 -->
        <form id="ratingForm" method="post" action="{% url 'comments:index' %}">
            {% csrf_token %}
            <div>
                <h2 class="mb-4 text-xl font-semibold text-center">推薦指數</h2>
                <div class="flex justify-center rating">
                    <input type="radio" name="rating" value="1" class="bg-orange-400 mask mask-star-2 rating-star" />
                    <input type="radio" name="rating" value="2" class="bg-orange-400 mask mask-star-2 rating-star" />
                    <input type="radio" name="rating" value="3" class="bg-orange-400 mask mask-star-2 rating-star" />
                    <input type="radio" name="rating" value="4" class="bg-orange-400 mask mask-star-2 rating-star" />
                    <input type="radio" name="rating" value="5" class="bg-orange-400 mask mask-star-2 rating-star" />
                </div>
                <textarea name="comment" class="w-full px-4 py-2 mt-5 mb-4 border rounded-md" rows="4" maxlength="1000" placeholder="留下你對該景點的評價吧!"></textarea>

                <label for="spot">選擇景點：</label>
                <select name="spot" id="spot" class="w-full px-4 py-2 mt-2 mb-4 border rounded-md">
                    <option value="">不選擇景點</option>
                    {% for spot in spots %}
                    <option value="{{ spot.id }}">{{ spot.name }}</option>
                    {% endfor %}
                </select>

                <button type="submit" class="block px-8 py-3 mx-auto text-xl font-bold text-white bg-light-blue rounded-3xl hover:bg-gray-500">提交</button>
            </div>
        </form>

        <!-- 顯示評論 -->
        <div class="mt-8">
            <h2 class="mb-4 text-xl font-semibold text-center">評論內容</h2>
            {% for comment in comments %}
            <div class="p-4 mb-4 border rounded-md comment">
                <p class="comment-content">{{ comment.content }}</p>
                <p>景點：{% if comment.spot %}{{ comment.spot.name }}{% else %}無{% endif %}</p>
                <p>評分: {{ comment.value }}</p>
                <form method="post" action="{% url 'comments:index' %}" class="hidden edit-form">
                    {% csrf_token %}
                    <input type="hidden" name="edit_comment_id" value="{{ comment.id }}">
                    <textarea name="edit_comment_content" class="w-full px-4 py-2 mb-4 border rounded-md" rows="2">{{ comment.content }}</textarea>
                    <button type="submit" class="text-blue-500 hover:underline">保存</button>
                    <button type="button" class="text-gray-500 cancel-edit-btn hover:underline">取消</button>
                </form>
                <div class="flex items-center justify-between mt-2">
                    <button class="text-blue-500 edit-comment-btn hover:underline">編輯留言</button>
                    <button class="text-red-500 delete-comment-btn hover:underline" data-comment-id="{{ comment.id }}">刪除留言</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    const loginUrl = "{% url 'login' %}";
    const commentsIndexUrl = "{% url 'comments:index' %}";
    const csrfToken = "{{ csrf_token }}";
</script>
<script src="{% static 'js/comments.js' %}"></script>

{% if alert %}
<input type="hidden" name="alert_type" value="{{ alert.type }}">
<input type="hidden" name="alert_message" value="{{ alert.message }}">
{% endif %}
<input type="hidden" name="is_logged_in" value="{{ user.is_authenticated }}">

{% endblock %}
