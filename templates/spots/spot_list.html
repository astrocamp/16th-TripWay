{% extends "layouts/base.html" %}
{% load static %}
{% block content %}
<div class="pt-8">
    <header class="flex items-center justify-between w-3/4 mx-auto">
        <div class="flex items-center">
            <a class="m-1 transition-colors duration-300 hover:text-sky-700" href="javascript:history.go(-1)">
                <i class="text-2xl fa-solid fa-reply"></i>
            </a>
            <h1 class="p-2 text-3xl font-bold">景點清單</h1>
        </div>
        <select id="sort-options" class="block px-3 py-2 m-1 text-xl text-black bg-white border-0 rounded-lg appearance-none w-52">
            <option value="rating_desc" {% if sort_option == 'rating_desc' %}selected{% endif %} class="bg-white appearance-none hover:bg-slate-200">依推薦指數</option>
            <option value="average_rating_desc" {% if sort_option == 'average_rating_desc' %}selected{% endif %} class="bg-white appearance-none hover:bg-slate-200">依評論分數</option>
            <option value="comment_count_desc" {% if sort_option == 'comment_count_desc' %}selected{% endif %} class="bg-white appearance-none hover:bg-slate-200">依評論人數</option>
        </select>
    </header>
</div>

<div class="w-3/4 mx-auto mt-2">
    <div class="flex flex-wrap justify-start gap-4">
        {% for spot in spots %}
        <div class="relative md-full lg:w-[48%] xl:w-[32%] mt-5 mb-1">
            <a href="{% url 'spots:show' spot.id %}" class="block h-full duration-300 ease-in-out bg-white border-2 cursor-pointer rounded-xl hover:bg-blue-300 hover:scale-105">
                <div class="w-full h-[220px] overflow-hidden rounded-t-xl">
                    <img src="{% if spot.image %}{{ spot.image.url }}{% else %}{% static 'img/tripdefault.png' %}{% endif %}" class="object-cover w-full h-full" alt="">
                </div>
                <div class="p-4">
                    <h2 class="w-full text-2xl font-bold truncate">{{ spot.name }}</h2>
                    <div class="flex items-center">
                        <div class="flex items-center mr-2">
                            {% if spot.total_comments > 0 %}
                                <div class="flex items-center">
                                    <input type="radio" name="average_rating" class="bg-orange-400 mask mask-star-2" value="1" checked disabled />
                                    <span class="ml-2 text-sky-700">
                                        {% with spot.average_rating|floatformat:1 as avg_rating %}
                                            {{ avg_rating }}
                                        {% endwith %}
                                    </span>
                                </div>
                            {% else %}
                                <span class="text-sky-700">尚無景點評分</span>
                            {% endif %}
                        </div>
                        <p class="text-xl truncate text-slate-700">{{ spot.city }}</p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places&callback=initMap" async defer></script>
{% endblock %}
