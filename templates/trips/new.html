{% extends 'layouts/base.html' %} {% block content %}
<div class="h-screen bg-blue-50">
  <header class="flex justify-start bg-sky-800">
    <a
      class="px-2 py-2 text-white bg-sky-800 hover:bg-sky-950"
      href="{% url 'trips:index' %}"
      ><i class="fa-solid fa-house-chimney"></i
    ></a>
    <h1 class="px-2 py-2 text-white bg-sky-800">新增行程</h1>
  </header>

  <div
    class="flex flex-col justify-center max-w-md min-h-full px-6 py-5 mx-auto lg:px-10 justify-self-start"
  >
    <div class="mb-6">
      <div class="w-full pic">
        <label for="pic" class="block text-sm font-bold leading-6 text-cyan-800"
          >封面照片</label
        >
        <img
          id="image"
          class="max-w-[370px] max-h-[200px]"
          src="{% if photos %}{{ photos.last.image.url }}{% else %}https://picsum.photos/370/200{% endif %}"
        />
      </div>
      <div style="display: flex; align-items: center">
        <form
          id="upload-form"
          action="{% url 'trips:upload_photo' %}"
          method="post"
          enctype="multipart/form-data"
        >
          {% csrf_token %}
          <input
            type="file"
            id="image-upload"
            style="display: none"
            name="image"
            accept="image/*"
          />
          <button
            type="button"
            class="px-4 py-2 mt-2 mr-2 font-bold text-white rounded bg-sky-800 hover:bg-sky-950"
            onclick="document.getElementById('image-upload').click();"
          >
            上傳圖片
          </button>
          <button type="submit" id="save-image-btn" class="px-4 py-2 mt-2 font-bold text-white rounded bg-sky-800 hover:bg-sky-950" >
            儲存圖片
          </button>
        </form>

        <form id="delete-form" action="{% url 'trips:delete_photo' %}" method="post" style="margin-left: 10px"
        >
          {% csrf_token %}
          <button type="button" id="delete-photo-btn" class="px-4 py-2 mt-2 font-bold text-white bg-red-600 rounded hover:bg-red-800">刪除圖片
          </button>
        </form>
      </div>
    </div>

    <form action="{% url 'trips:add' %}" method="post" class="mt-8">
      {% csrf_token %}
      <div class="mb-6">
        <label for="name" class="block text-sm font-bold leading-6 text-cyan-800">行程名稱：</label>
        <input type="text" name="name" id="name" required="required" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
      </div>

      <div class="mb-6">
        <label for="start_date" class="block text-sm font-bold leading-6 text-cyan-800">出發日：</label>
        <input type="date" name="start_date" id="start_date" value="" required min="{% now 'Y-m-d' %}" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
      </div>

      <div class="mb-6">
        <label for="end_date" class="block text-sm font-bold leading-6 text-cyan-800">結束日：</label>
        <input type="date" name="end_date" id="end_date" value="" required min="{% now 'Y-m-d' %}" class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" />
      </div>

      <div class="mb-6">
        <label for="transportation" class="block text-sm font-bold leading-6 text-cyan-800">交通方式：</label>
        <select class="block w-full h-12 pl-1 mt-1 mb-3 border-gray-300 rounded-md shadow-sm form-input focus:border-indigo-600 focus:ring focus:ring-cyan-800 focus:ring-opacity-50" name="transportation">
          <option value="">走路</option>
          <option value="">汽車</option>
          <option value="">機車</option>
          <option value="">大眾運輸</option>
        </select>
      </div>
      <div class="flex justify-center">
        <button class="px-4 py-2 font-bold text-white rounded bg-sky-800 hover:bg-sky-950"><input type="submit" value="建立新行程" /></button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  document
    .getElementById("image-upload")
    .addEventListener("change", function (event) {
      const selectedFile = event.target.files[0];
      if (selectedFile) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("image").src = e.target.result;
        };
        reader.readAsDataURL(selectedFile);
      }
    });

  document
    .getElementById("delete-photo-btn")
    .addEventListener("click", function () {
      Swal.fire({
        title: "確認刪除圖片？",
        showCancelButton: true,
        confirmButtonText: "確認",
        cancelButtonText: "取消",
        icon: "warning",
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById("delete-form").submit();
        }
      });
    });
    document.getElementById("save-image-btn").addEventListener("click", function(event) {
      event.preventDefault();
        document.getElementById("upload-form").submit();
    });
</script>

{% endblock %}

